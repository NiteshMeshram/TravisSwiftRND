# .travis.yml
# XcodeTravis
#
# Created by V2Solutions on 16/03/15.
# Copyright (c) 2014 ___v2Tech Ventures___. All rights reserved.

#Travis CI and V2 GPTI standard configuration file
#Do not change any configuration except env/global: variable content
#Alignment of text is important in travis so do not reformat the file and indentation of the content.
#Do not use TAB in the file.
#Validated the .travis.yml with _* **http://www.yamllint.com/* (http://lint.travis-ci.org/)

#Defines the language to be used by travis for compilation
language: objective-c


#osx_image: xcode7.3  # we're telling travis to use xcode 7.3

notifications:
email:
recipients:
- nitesh.meshram@v2solutions.com
on_success: always
on_failure: always


env:
  global:
#DEVELOPER_NAME : must have the name appeared on the certificate used. Generally this should not be changed.
    - 'DEVELOPER_NAME="iPhone Distribution: V2Solutions, Inc."'
#PROFILE_NAME : Certificate profile name. Generally this should not be changed
- PROFILE_NAME="Distribution"
#APP_PROFILE_PATH : GITHUB repository relative path for the provisioning profile.
#                   Standard file already available in respective folder.
#                   DO not change until scripts or profile folder name changed.
- APP_PROFILE_PATH="./scripts/profile/"
#APP_SCRIPT_PATH : Shell script path which is referred internally. Do not change until scripts folder name changed.
- APP_SCRIPT_PATH="./scripts/certs/"
#APP_APPLE_CERTIFICATE : Apple standard certificate. Do not changed until required.
- APP_APPLE_CERTIFICATE="apple.cer"
#APP_TEAM_AGENT_DISTRIBUTION_CERTIFICATE : Certificated generated from Apple portal.
#                                          Do not change until certificate is expired / regenerated
- APP_TEAM_AGENT_DISTRIBUTION_CERTIFICATE="Certificates.cer"
#APP_TEAM_DISTRIBUTION_PRIVATE_KEYS :  Private key generated using key chain. Do not change until regenerated.
- APP_TEAM_DISTRIBUTION_PRIVATE_KEYS="Key.p12"
#APP_NAME : Name of the .app and .ipa file
- APP_NAME="LendingTree"
#APP_WORKSPACE_PATH : Relative path of the .xcworkspace file
- APP_WORKSPACE_PATH="./V2TravisSwifRND.xcworkspace"
#APP_SCHEME : Name of the xCode scheme. It is assume that all the scheme has the same name.
#             It is automatically suffixed by scheme (DEV/QA/UAT)
- APP_SCHEME="Money Center"
#Settings For Getting Pivotal Notes : Settings For Getting Pivotal Notes
- INFOPLIST_FILE="./V2TravisSwifRND/Info.plist"
#- PIVOTAL_PROJECT_ID=1114232
#- PIVOTAL_TOKEN='763aa9881c2d64966f6c17be60926221'
- OUTPUT_FILE_NAME='jsonresponse.text'
#DEV_HOCKEY_APP_ID : HOCKEY APP ID and Token for DEV scheme
- DEV_HOCKEY_APP_ID="8b8b2bcd857148ddaa5d6428c5212874"
- DEV_HOCKEY_APP_TOKEN="9a172758bdfe4fe4b10299bfc9ea519a"


# List of scripts to be executed before execution of "before_script"
before_install:
- chmod a+x scripts/config.sh
- chmod a+x scripts/TestShellScript.sh
- chmod a+x scripts/add-key.sh
- chmod a+x scripts/remove-key.sh
- chmod a+x scripts/update-bundle.sh
- chmod a+x scripts/sign-and-upload.sh

# List of scripts to be executed before execution of script
before_script:
- "./scripts/TestShellScript.sh"
- "./scripts/add-key.sh"
- "./scripts/update-bundle.sh"

#Command to be executed in "script".
script:
- "./scripts/TestShellScript.sh"
#Default Value for APP_BUILD_ENV
- APP_BUILD_ENV=DEV

#Condition which defines the Build env used in the xctool based on the branch
#For Branch : develop --> DEV scheme used
#For Branch : QA --> QA scheme used
#For Branch : master --> UAT scheme used
#No Travis CI support for DEBUG and PROD scheme.

#- if [ "$TRAVIS_BRANCH" = "QA" ]; then
#APP_BUILD_ENV=QA;
#echo "QA Scheme Selected.";
#elif [ "$TRAVIS_BRANCH" = "master" ]; then
#APP_BUILD_ENV=UAT;
#echo "UAT Scheme Selected.";
#fi

#command to build the .app for specific scheme
- xctool -workspace "$APP_WORKSPACE_PATH" -scheme "$APP_SCHEME.$APP_BUILD_ENV" -sdk iphoneos -configuration "$APP_BUILD_ENV" OBJROOT="$PWD/build" SYMROOT="$PWD/build" ONLY_ACTIVE_ARCH=NO
#command to run unit test for specific scheme
- xctool test -workspace "$APP_WORKSPACE_PATH" -scheme "$APP_SCHEME.$APP_BUILD_ENV" -sdk iphonesimulator ONLY_ACTIVE_ARCH=NO

#Scripts to be executed after execution of "script"
after_script:
#Remove key generated by add-key.sh
- "./scripts/remove-key.sh"

#executed after successful execution of "script"
after_success:
#Sign the build using certs and upload to Hockey App
#based on specified tokens and ids when all the command are executed successfuly
#This sign will upload the .ipa to Hockey App
- "./scripts/sign-and-upload.sh"

#executed after failed execution of "script"
after_failure:
#Sign the build using certs and upload to Hockey App
#based on specified tokens and ids when the unit tests failed to execute
#Logic:
#This script will sign the .app if generated successfully by "script"
# else the step will be ignored.
#If the .ipa file is generated successfully by sign step
#than upload script will upload to Hockey app.

- "./scripts/sign-and-upload.sh"

